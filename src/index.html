<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sweden Electricity Time-Price Planner</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMjU2M2VCIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCI+PHBhdGggZD0iTTEzIDEgbC04LjIgMTcuMyBjLS4zLjctLjEgMS41LjkgMS41IGg0LjEgdiA1LjEgYzAgLjUuMyAxIC44IDEuMXMxLS4zIDEuMS0uOGw2LjctMTUuNyBjLjMtLjctLjEtMS41LS45LTEuNSBoLTQuMSBWIDEuMSBjMC0uNS0uMy0xLS44LTEuMSBzLTEgLjMtMS4xLjhoLTQuMiIgLz48L3N2Zz4="
    />
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <!-- Chart.js for graphing -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="sweden-electricity-time-price-planner.css" />
  </head>
  <body
    class="bg-gray-50 min-h-screen p-4 md:p-8 flex items-center justify-center"
  >
    <div
      id="app-container"
      class="w-full max-w-2xl bg-white rounded-xl shadow-2xl p-6 md:p-8 border border-gray-100"
    >
      <!-- Header -->
      <header class="text-center mb-8">
        <h1
          class="text-4xl font-extrabold text-gray-800 flex items-center justify-center gap-2"
        >
          <span class="flex items-center justify-center gap-4 w-full">
            <span class="text-3xl">‚ö°</span>
            <span class="flex-1 text-center">
              Sweden Electricity<br />
              Time-Price Planner
            </span>
            <span class="ml-2 animate-spin inline-block text-yellow-400"
              >üí°</span
            >
          </span>
        </h1>
        <p
          class="text-gray-500 mt-3 text-lg flex items-center justify-center gap-2"
        >
          Find the cheapest non-overlapping slots for your energy needs over the
          next 48 hours!
        </p>
        <p
          class="text-gray-400 mt-2 text-sm flex items-center justify-center gap-1"
        >
          üìÖ Tomorrow‚Äôs prices published daily after
          <span class="font-semibold text-blue-700">13:00 (1 PM)</span>
          ‚è∞
        </p>
        <!-- Animate.css CDN for animations -->
        <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
        />
      </header>

      <!-- Current Time Display -->
      <div
        class="text-center mb-6 p-3 bg-blue-50 rounded-lg border border-blue-200"
      >
        <p class="text-sm font-semibold text-blue-700">Current Device Time:</p>
        <p id="current-time" class="text-lg font-bold text-blue-900"></p>
        <p class="text-xs text-gray-500 mt-1">
          (Prices are calculated from periods that START after this time.)
        </p>
      </div>

      <!-- Input Form (Improved Alignment) -->
      <div class="space-y-4">
        <!-- Row 1: Zone and Time Slot -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label
              for="priceZone"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Where are you in Sweden?</label
            >
            <select
              id="priceZone"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 bg-white"
            >
              <option value="SE1">SE1 (Lule√•)</option>
              <option value="SE2">SE2 (Sundsvall)</option>
              <option value="SE3">SE3 (Stockholm)</option>
              <option value="SE4" selected>SE4 (Malm√∂)</option>
            </select>
          </div>
          <div>
            <label
              for="timeSlot"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Which part of the day?</label
            >
            <select
              id="timeSlot"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 bg-white"
            >
              <option value="0-24" selected>Today & Tomorrow (All Day)</option>
              <option value="0-8">Night/Morning (00:00 - 08:00)</option>
              <option value="8-16">Day (08:00 - 16:00)</option>
              <option value="16-24">Evening/Peak (16:00 - 24:00)</option>
            </select>
          </div>
        </div>

        <!-- Row 2: Hours and Slots Count -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label
              for="minutesNeeded"
              class="block text-sm font-medium text-gray-700 mb-1"
              >How long do you need? (Minutes)</label
            >
            <input
              type="number"
              id="minutesNeeded"
              value="60"
              min="15"
              max="2880"
              step="15"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
            />
          </div>
          <div>
            <label
              for="topSlotsNeeded"
              class="block text-sm font-medium text-gray-700 mb-1"
              >How many options to show?</label
            >
            <input
              type="number"
              id="topSlotsNeeded"
              value="4"
              min="1"
              max="10"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
            />
          </div>
        </div>

        <!-- Fixed Cost Inputs -->
        <div class="grid grid-cols-3 gap-4 border-t pt-4 border-gray-200">
          <div>
            <label
              for="gridFee"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Grid Fee (SEK/kWh)</label
            >
            <input
              type="number"
              id="gridFee"
              value="0"
              step="0.01"
              min="0"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
            />
          </div>
          <div>
            <label
              for="energyTax"
              class="block text-sm font-medium text-gray-700 mb-1"
              >Energy Tax (SEK/kWh)</label
            >
            <input
              type="number"
              id="energyTax"
              value="0"
              step="0.01"
              min="0"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
            />
          </div>
          <div>
            <label
              for="vatPercentage"
              class="block text-sm font-medium text-gray-700 mb-1"
              >VAT (%)</label
            >
            <input
              type="number"
              id="vatPercentage"
              value="0"
              min="0"
              max="100"
              step="1"
              class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150"
            />
          </div>
        </div>

        <!-- Calculation Button -->
        <button
          id="calculateButton"
          class="w-full py-3 px-4 bg-blue-600 text-white font-semibold rounded-xl shadow-md hover:bg-blue-700 transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center mt-4"
        >
          <svg
            id="loading-spinner"
            class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          Show me the best times!
        </button>
      </div>

      <!-- Status & Results Area -->
      <div id="status-and-results" class="mt-8">
        <div
          id="data-status"
          class="mb-4 p-3 text-sm rounded-lg bg-green-100 border border-green-300 text-green-800 hidden"
        >
          <!-- Live status updates go here -->
        </div>

        <div
          id="results"
          class="bg-gray-50 p-6 rounded-xl border border-gray-200"
        >
          <h2 class="text-xl font-semibold text-gray-800 mb-3">
            Cheapest Non-Overlapping Slots
          </h2>
          <div id="message-box" class="text-gray-600">
            Select your zone and duration, then click 'Show me the best times!'.
          </div>

          <!-- Chart Area -->
          <div
            class="mt-6 mb-8 p-4 bg-white rounded-lg shadow-inner border border-gray-100 hidden"
            id="chart-container"
          >
            <h3 class="font-semibold text-lg mb-2 text-gray-700">
              48-Hour Price Curve (Calculated)
            </h3>
            <canvas id="priceChart"></canvas>
          </div>

          <div id="slot-results-container" class="mt-4 space-y-4">
            <!-- Best slots will be inserted here -->
          </div>

          <p
            id="disclaimer-note"
            class="text-xs text-red-500 mt-6 hidden font-medium border-t pt-3 border-gray-200"
          >
            ‚ö†Ô∏è **Disclaimer:** The resulting prices are based on **Nord Pool
            spot prices** adjusted by your input fees. These are *estimates* and
            may not match your exact consumer bill due to specific utility
            contract fees or government subsidies.
          </p>
        </div>
      </div>

      <!-- Gemini LLM Feature: Energy Strategy Assistant -->
      <div
        id="strategy-generator-container"
        class="mt-8 p-6 bg-purple-50 rounded-xl shadow-xl border border-purple-200 hidden"
      >
        <h2 class="text-xl font-bold text-purple-800 mb-3 flex items-center">
          ‚ú® Energy Strategy Assistant
        </h2>
        <p class="text-sm text-purple-700 mb-4">
          Tell the assistant your energy-intensive tasks (e.g., duration,
          appliance) and it will suggest an optimal schedule based on the cheap
          slots found above.
        </p>

        <textarea
          id="taskInput"
          rows="3"
          placeholder="My tasks: Run dishwasher (1.5h), start heat pump (3h), charge electric car battery (4h)..."
          class="w-full p-3 border border-purple-300 rounded-lg shadow-inner focus:ring-purple-500 focus:border-purple-500 mb-4"
        ></textarea>

        <button
          id="generateStrategyButton"
          class="w-full py-3 px-4 bg-purple-600 text-white font-semibold rounded-xl shadow-md hover:bg-purple-700 transition duration-200 disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center"
        >
          <svg
            id="gemini-loading-spinner"
            class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden"
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
          >
            <circle
              class="opacity-25"
              cx="12"
              cy="12"
              r="10"
              stroke="currentColor"
              stroke-width="4"
            ></circle>
            <path
              class="opacity-75"
              fill="currentColor"
              d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
            ></path>
          </svg>
          ‚ú® Generate Optimization Strategy
        </button>

        <div
          id="strategyOutput"
          class="mt-4 p-4 bg-white rounded-lg border border-purple-300 min-h-[50px] text-gray-700 leading-relaxed text-sm"
        >
          The best scheduling advice will appear here once generated.
        </div>
      </div>

      <p class="text-xs text-center text-gray-400 mt-6">
        Base price data sourced live from
        <a
          href="https://www.elprisetjustnu.se"
          target="_blank"
          class="text-blue-500 hover:underline"
          >elprisetjustnu.se</a
        >.
      </p>
    </div>
    <script src="sweden-electricity-time-price-planner.js"></script>
  </body>
</html>
